# 常见SQL优化方式

## 1.创建索引

- [ ] 要尽量避免全表扫描，首先应考虑where及order by 涉及的列上建立索引。
- [ ] 在经常需要进行检索的字段上创建索引。
- [ ] 一个表的索引数最好不要超过六个。索引虽然提高了select的效率，但是也降低了insert及update的效率。

## 2. 避免在索引上使用计算

+ 在where字句中，如果索引列是计算或者函数的一部分，DBMS的优化器将不会使用索引而使用全表查询,函数
  属于计算的一种,同时在in和exists中通常情况下使用EXISTS，因为in不走索引。
  效率低：

```sql
 select * from user where salary*22>11000   (salary是索引列)
```


​       效率高：

```sql
 select * from user where salary>11000/22   (salary是索引列)
```

## 3. 使用预编译查询

+ 程序中通常是根据用户的输入来动态执行SQL，这时应该尽量使用参数化SQL,这样不仅可以避免SQL注入漏洞
  攻击，最重要数据库会对这些参数化SQL进行预编译，这样第一次执行的时候DBMS会为这个SQL语句进行查询优化
  并且执行预编译，这样以后再执行这个SQL的时候就直接使用预编译的结果，这样可以大大提高执行的速度。

## 4.调整Where字句中的连接顺序

+ DBMS一般采用自下而上的顺序解析where字句，根据这个原理表连接最好写在其他where条件之前，那些可以
  过滤掉最大数量记录。

## 5. 尽量将多条SQL语句压缩到一句SQL中

+ 每次执行SQL的时候都要建立网络连接、进行权限校验、进行SQL语句的查询优化、发送执行结果，这个过程是非常耗时的，因此应该避免过多的执行SQL语句，能够压缩到一句SQL执行的语句就不要多条来执行。

## 6.用where字句替换HAVING字句

+ 避免使用HAVING字句，因为HAVING只会在检索出所有记录之后才对结果集进行过滤，而where则是在聚合前刷选记录，如果能通过where字句限制记录的数目，那就能减少这方面的开销。HAVING中的条件一般用于聚合函数的过滤，除此之外，应该将条件写where字句中。

## 7.查询select语句优化

+ 任何地方都不要使用select * from t, 要具体的字段列表代替“*“ ，不要返回用不到的字段。
+ 应尽量避免在where子句中字段进行null值判断，否则将导致引擎放弃使用索引而进行全表扫描。

## 8. 更新update语句优化

+ 如果只更新一两个字段，就不要更新全部字段，否则会导致频繁调用引起明细的性能消耗，同时带来大量日志。

## 9. 插入Insert语句优化

+ 在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。